<!DOCTYPE html>
<html lang="en">
	<!-- Head -->
	<head>
		<meta charset="UTF8"/>
		<title> VTG: 24 Sphere With Material </title>
	</head>
	
	<!--Body-->
	<body onload="main()">
		<canvas id="AMC" width="800" height="600">
			Your browser does not support HTML5 canvas element
		</canvas>
		<script src="gl-matrix-min.js"></script> 
		<script src="Sphere.js"></script> 
		<script src="Mesh.js"></script> 
		<script src="24SphereWithMaterial.js"></script>
		<script type="x-shader/vertex-shader" id="vs">#version 300 es
			in vec4 vPosition;
			in vec3 vNormal;
			uniform mat4 u_model_matrix;
			uniform mat4 u_view_matrix;
			uniform mat4 u_projection_matrix;
			uniform mat4 u_rotation_matrix;
			uniform vec4 u_light_position;
			uniform mediump int u_L_key_pressed;
			out vec3 transformed_normals;
			out vec3 light_direction;
			out vec3 viewer_vector;
			void main(void)
			{
				if (1 == u_L_key_pressed)
				{
					vec4 eyeCoordinates = u_view_matrix * u_model_matrix * vPosition;
					transformed_normals = normalize(mat3(u_view_matrix * u_model_matrix) * vNormal);
					vec4 rotated_light_position = u_rotation_matrix * u_light_position;
					light_direction = normalize(vec3(rotated_light_position) - eyeCoordinates.xyz);
					viewer_vector = normalize(-eyeCoordinates.xyz);
					transformed_normals = normalize(transformed_normals);
					light_direction = normalize(light_direction);
					viewer_vector = normalize(viewer_vector);
				}
				gl_Position = u_projection_matrix * u_view_matrix * u_model_matrix * vPosition;
			}
		</script>
		<script type="x-shader/fragment-shader" id="fs">#version 300 es
			precision highp float;	
			in vec3 transformed_normals;
			in vec3 light_direction;
			in vec3 viewer_vector;
			uniform vec3 u_La;
			uniform vec3 u_Ld;
			uniform vec3 u_Ls;	
			uniform vec3 u_Ka;
			uniform vec3 u_Kd;
			uniform vec3 u_Ks;
			uniform float u_material_shininess;
			uniform int u_L_key_pressed;
			out vec4 vFragColor;
			void main(void)
			{
				vec3 phong_ads_color;
				if (1 == u_L_key_pressed)
				{
					vec3 normalized_transformed_normals = normalize(transformed_normals);
					vec3 normalized_light_direction = normalize(light_direction);
					vec3 normalized_viewer_vector = normalize(viewer_vector);
					vec3 ambient = u_La * u_Ka;
					float tn_dot_ld = max(dot(normalized_transformed_normals, normalized_light_direction), 0.0);
					vec3 diffuse = u_Ld * u_Kd * tn_dot_ld;
					vec3 reflection_vector = reflect(-normalized_light_direction, normalized_transformed_normals);
					vec3 specular = u_Ls * u_Ks * pow(max(dot(reflection_vector, normalized_viewer_vector), 0.0), u_material_shininess);
					phong_ads_color = ambient + diffuse + specular;
				}
				else
				{
					phong_ads_color = vec3(1.0,1.0,1.0);
				}
				vFragColor = vec4(phong_ads_color, 1.0);
			}
		</script>
	</body>
</html> 
